<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.ktds.targetai.mapper.RuleMapper">

	<!-- RULE 리스트 조회 -->
	<select id="getRuleList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT 
			R.RULE_ID,
		    R.RULE_NM,
		    R.NO_LOOP,
		    R.LOCK_ON_ACTIVE,
		    R.AGENDA_GRP,
		    R.SALIENCE,
		    R.EFFECTIVE_DT,
		    R.EXPIRES_DT,
		    R.ENABLED,
		    R.DURATION,
		    R.ATTR_THEN,
		    R.NUM_OF_TGT,
		    R.PKG_ID,
		    R.CAMP_ID,
		    DATE_FORMAT(R.REG_DT, '%Y-%m-%d %h:%i:%s') AS REG_DT,
		    R.REG_USRID,
		    M.MEMBER_NAME REG_USRNM,
		    DATE_FORMAT(R.UDT_DT, '%Y-%m-%d %h:%i:%s') AS UDT_DT,
		    R.UDT_USRID,
		    M1.MEMBER_NAME UDT_USRNM
		FROM 
			targetai.RULE R
			LEFT JOIN targetai.MEMBER M ON (R.REG_USRID = M.MEMBER_ID)
		    LEFT JOIN targetai.MEMBER M1 ON (R.UDT_USRID = M1.MEMBER_ID)
		WHERE 1=1
		<if test="pkgId != null and pkgId != ''">AND PKG_ID = #{pkgId}</if>
		<if test="ruleId_search != null and ruleId_search != ''">AND RULE_ID = #{ruleId_search}</if>
	    <if test="ruleRegUsrId_search != null and ruleRegUsrId_search != ''">AND REG_USRID = #{ruleRegUsrId_search}</if>
	    <if test="ruleNm_search != null and ruleNm_search != ''">AND RULE_NM LIKE CONCAT('%', #{ruleNm_search}, '%')</if>
	    ORDER BY RULE_ID DESC
		LIMIT #{limit}
		OFFSET #{offset}
	</select>
	
	<!-- RULE 조회된 개수 조회 -->
	<select id="getRuleCount"  parameterType="java.util.HashMap" resultType="int">
		SELECT 
			COUNT(*) AS CNT
		FROM targetai.RULE
		WHERE 1=1
		<if test="pkgId != null and pkgId != ''">AND PKG_ID = #{pkgId}</if>
		<if test="ruleId_search != null and ruleId_search != ''">AND RULE_ID = #{ruleId_search}</if>
	    <if test="ruleRegUsrId_search != null and ruleRegUsrId_search != ''">AND REG_USRID = #{ruleRegUsrId_search}</if>
	    <if test="ruleNm_search != null and ruleNm_search != ''">AND RULE_NM LIKE CONCAT('%', #{ruleNm_search}, '%')</if>
	</select>
	
</mapper>